<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Picture Upload Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .file-upload {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .file-input {
            display: none;
        }
        .upload-btn {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .upload-btn:hover {
            background: #0056b3;
        }
        .preview-container {
            margin-top: 15px;
            display: none;
        }
        .preview-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ddd;
        }
        .remove-btn {
            background: #dc3545;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        .submit-btn {
            background: #28a745;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .submit-btn:hover {
            background: #218838;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .users-list {
            margin-top: 30px;
        }
        .user-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
        }
        .user-info {
            flex: 1;
        }
        .user-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .user-details {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Profile Picture Upload Test</h1>
    
    <div class="test-container">
        <h3>Test Purpose</h3>
        <p>This page tests the profile picture upload functionality when creating users. Admin should be able to upload profile pictures and see them displayed in the user list.</p>
    </div>
    
    <div class="test-container">
        <h3>Create User with Profile Picture</h3>
        
        <form id="createUserForm">
            <div class="form-group">
                <label for="name">Full Name:</label>
                <input type="text" id="name" required>
            </div>
            
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" required>
            </div>
            
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" required>
            </div>
            
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" required>
            </div>
            
            <div class="form-group">
                <label for="role">Role:</label>
                <select id="role" required>
                    <option value="">Select Role</option>
                    <option value="user">User</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Profile Picture:</label>
                <div class="file-upload">
                    <input type="file" id="profilePicture" class="file-input" accept="image/*">
                    <button type="button" class="upload-btn" onclick="document.getElementById('profilePicture').click()">
                        ðŸ“· Choose Photo
                    </button>
                </div>
                
                <div id="previewContainer" class="preview-container">
                    <img id="previewImage" class="preview-image" src="" alt="Preview">
                    <br>
                    <button type="button" class="remove-btn" onclick="removePhoto()">Remove Photo</button>
                </div>
            </div>
            
            <button type="submit" class="submit-btn">Create User</button>
        </form>
        
        <div id="status" class="status" style="display: none;"></div>
    </div>
    
    <div class="test-container users-list">
        <h3>Existing Users</h3>
        <button onclick="loadUsers()" class="submit-btn">Refresh Users</button>
        <div id="usersList"></div>
    </div>

    <script>
        const API_BASE = 'https://cursor-of-jswork-copy-backend.onrender.com';
        let selectedFile = null;
        
        // File upload handling
        document.getElementById('profilePicture').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) { // 5MB limit
                    showStatus('File size must be less than 5MB', 'error');
                    return;
                }
                
                selectedFile = file;
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('previewImage').src = e.target.result;
                    document.getElementById('previewContainer').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });
        
        function removePhoto() {
            selectedFile = null;
            document.getElementById('profilePicture').value = '';
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('previewImage').src = '';
        }
        
        // Form submission
        document.getElementById('createUserForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('name', document.getElementById('name').value.trim());
            formData.append('username', document.getElementById('username').value.trim());
            formData.append('email', document.getElementById('email').value.trim());
            formData.append('password', document.getElementById('password').value.trim());
            formData.append('role', document.getElementById('role').value);
            
            if (selectedFile) {
                formData.append('profilePicture', selectedFile);
            }
            
            try {
                showStatus('Creating user...', 'success');
                
                const response = await fetch(`${API_BASE}/register`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showStatus(`User created successfully! Account: ${result.user.account_number}`, 'success');
                    document.getElementById('createUserForm').reset();
                    removePhoto();
                    loadUsers(); // Refresh user list
                } else {
                    const error = await response.json();
                    showStatus(error.error || 'Failed to create user', 'error');
                }
            } catch (error) {
                console.error('Create error:', error);
                showStatus('Error creating user', 'error');
            }
        });
        
        // Load users
        async function loadUsers() {
            try {
                const response = await fetch(`${API_BASE}/users`);
                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users);
                } else {
                    showStatus('Failed to load users', 'error');
                }
            } catch (error) {
                console.error('Load users error:', error);
                showStatus('Error loading users', 'error');
            }
        }
        
        function displayUsers(users) {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            if (users.length === 0) {
                usersList.innerHTML = '<p>No users found.</p>';
                return;
            }
            
            users.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                
                let avatarHtml = '';
                if (user.profile_picture) {
                    avatarHtml = `<img src="${API_BASE}${user.profile_picture}" alt="${user.name}" class="user-avatar">`;
                } else {
                    const initials = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                    avatarHtml = `<div class="user-avatar" style="background: #007bff; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">${initials}</div>`;
                }
                
                userCard.innerHTML = `
                    ${avatarHtml}
                    <div class="user-info">
                        <div class="user-name">${user.name}</div>
                        <div class="user-details">
                            <div>Email: ${user.email}</div>
                            <div>Account: ${user.account_number || 'N/A'}</div>
                            <div>Balance: $${user.account_balance || '0.00'}</div>
                            <div>Role: ${user.role}</div>
                        </div>
                    </div>
                `;
                
                usersList.appendChild(userCard);
            });
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }
        
        // Load users on page load
        loadUsers();
        
        console.log('Profile picture upload test page loaded');
    </script>
</body>
</html> 